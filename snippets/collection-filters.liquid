{% comment %}
  Simple collection filters snippet.
  Usage: {% render 'collection-filters', results: collection %}
{% endcomment %}

{% liquid
  assign results = results | default: collection
%}

{% if results.filters.size > 0 %}
  <form id="FiltersForm" class="collection-filters">
    {% for filter in results.filters %}
      <details class="filter-group" {% if filter.active_values %}open{% endif %}>
        <summary class="filter-summary">{{ filter.label }}</summary>
        <div class="filter-group-display">
          {% case filter.type %}
            {% when 'list' %}
              {% for value in filter.values %}
                <label class="filter-value">
                  <input type="checkbox"
                         name="{{ value.param_name }}"
                         value="{{ value.value }}"
                         {% if value.active %}checked{% endif %}
                         {% if value.count == 0 and value.active == false %}disabled{% endif %}>
                  <span>{{ value.label }} ({{ value.count }})</span>
                </label>
              {% endfor %}
            {% when 'price_range' %}
              <div class="filter-range-slider">
                <label class="range-control">
                  <span>{{ 'From' }}</span>
                  <input type="range" id="price-min" name="{{ filter.min_value.param_name }}"
                         value="{{ filter.min_value.value | money_without_currency }}"
                         min="0" max="{{ filter.range_max | money_without_currency }}">
                  <span class="range-value" data-target="price-min"></span>
                </label>
                <label class="range-control">
                  <span>{{ 'To' }}</span>
                  <input type="range" id="price-max" name="{{ filter.max_value.param_name }}"
                         value="{{ filter.max_value.value | money_without_currency }}"
                         min="0" max="{{ filter.range_max | money_without_currency }}">
                  <span class="range-value" data-target="price-max"></span>
                </label>
              </div>
          {% endcase %}
        </div>
      </details>
    {% endfor %}
    <button type="submit" class="filter-apply">{{ 'Apply' }}</button>
  </form>
{% endif %}

{% stylesheet %}
.collection-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: var(--color-card-bg, #f9f9f9);
  border: 1px solid var(--color-border, #ddd);
  border-radius: var(--border-radius-lg, 8px);
  box-shadow: var(--shadow-sm, 0 1px 2px rgba(0,0,0,0.05));
}
.filter-group {
  flex: 1 1 220px;
  background: #fff;
  border: 1px solid var(--color-border, #ddd);
  border-radius: var(--border-radius, 4px);
  padding: 0.5rem 1rem;
}
.filter-summary {
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 0.5rem;
}
.filter-group-display {
  margin-left: 0;
}
.filter-value {
  display: block;
  margin-bottom: 0.25rem;
  font-size: 0.9rem;
}
.filter-range-slider {
  width: 100%;
}
.range-control {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}
.filter-range-slider input[type=range] {
  flex: 1;
  accent-color: var(--color-accent, #1e1e1e);
}
.range-value {
  font-size: 0.85rem;
  min-width: 2.5rem;
  text-align: center;
}
.filter-apply {
  align-self: flex-end;
  padding: 0.5rem 1rem;
  background: var(--color-accent, #1e1e1e);
  color: #fff;
  border: none;
  border-radius: var(--border-radius, 4px);
  cursor: pointer;
}
{% endstylesheet %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.filter-range-slider input[type="range"]').forEach(function(slider) {
      var display = slider.parentElement.querySelector('.range-value');
      var update = function() { display.textContent = slider.value; };
      slider.addEventListener('input', update);
      update();
    });
  });
</script>
